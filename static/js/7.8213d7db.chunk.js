(this.webpackJsonpdisc=this.webpackJsonpdisc||[]).push([[7],{415:function(e,t){},416:function(e,t){},448:function(e,t){},507:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return H}));var n=r(12),c=(r(498),r(26)),o=r(1),i=r(181),a=r(183),s=r(5),u=r.p+"static/media/p2.2bd44c1d.mp4",b=r(0);function d(e){var t=e.predictions,r=Object(o.useRef)();return Object(i.b)((function(){if(!(t.current.length<=0)&&r.current){var e=t.current[0].boundingBox.topLeft,n=t.current[0].boundingBox.bottomRight,c=(e[0]+n[0])/2,o=(e[1]+n[1])/2,i=n[0]-e[0],a=n[1]-e[1];r.current.scale.setX(i),r.current.scale.setY(a),r.current.position.setX(c),r.current.position.setY(o)}})),Object(b.jsxs)("mesh",{ref:r,frustumCulled:!1,children:[Object(b.jsx)("planeBufferGeometry",{}),Object(b.jsx)("meshNormalMaterial",{color:"red",transparent:!0,opacity:.1})]})}var j=r(180);function l(e){var t=e.predictions,r=Object(o.useRef)();return Object(i.b)((function(){var e;if(!(t.current.length<=0)){var n=t.current[0].scaledMesh.flat();null===(e=r.current)||void 0===e||e.setAttribute("position",new j.BufferAttribute(new Float32Array(n),3))}})),Object(b.jsxs)("points",{frustumCulled:!1,children:[Object(b.jsx)("bufferGeometry",{ref:r}),Object(b.jsx)("pointsMaterial",{color:"#20BF00",size:.08})]})}var f=function(e){var t=e.children,r=Object(i.d)().viewport;return Object(b.jsx)("group",{scale:[r.width,r.height,1],position:[-r.width/2,r.height/2,0],children:t})},h=r(65),p=r(509),O=r(504),v=r.p+"static/media/vomit.246b25a7.gltf",m=function(e){var t=e.predictions,r=Object(o.useRef)(),n=Object(p.a)(v),c=n.nodes,a=(n.materials,n.animations),s=Object(O.a)(a),u=s.ref,d=(s.mixer,s.names,s.actions);s.clips;return Object(o.useEffect)((function(){var e,t=d.Action;t&&(t.loop=j.LoopRepeat,t.play(),(null===c||void 0===c||null===(e=c.Cube)||void 0===e?void 0:e.material)&&(c.Cube.material=new j.MeshBasicMaterial({color:"red"})))})),Object(i.b)((function(){var e,n=t.current[0];if(n&&r.current){var c=n.scaledMesh,o=n.orthoVectors,i=o.up,a=o.forward;(e=r.current.position).set.apply(e,Object(h.a)(c[13])).add(new j.Vector3(0,0,0));var s=new j.Vector3;r.current.getWorldPosition(s),r.current.up.copy(i),r.current.lookAt(a.clone().negate().add(s)),u.current&&(u.current.visible=n.mouthOpened>.5)}})),Object(b.jsxs)("group",{ref:r,frustumCulled:!1,scale:[.04,.1,.1],children:[Object(b.jsx)("group",{ref:u,rotation:[0,Math.PI/2,0],position:[0,0,3],children:Object(b.jsx)("primitive",{object:c.Cube})}),Object(b.jsxs)("mesh",{position:[0,0,-1.5],children:[Object(b.jsx)("boxBufferGeometry",{}),Object(b.jsx)("meshNormalMaterial",{color:"red",transparent:!0,opacity:1})]})]})},g=function(e){var t=e.predictions;return Object(b.jsxs)(f,{children:[Object(b.jsx)(l,{predictions:t}),Object(b.jsx)(d,{predictions:t}),Object(b.jsx)(o.Suspense,{fallback:null,children:Object(b.jsx)(m,{predictions:t})})]})},x=r(13),w=r.n(x),V=r(69),M=r(20),y=r(258),B=r(499);function R(){return function(e,t,r){var c=Object(o.useState)(r),i=Object(n.a)(c,2),a=i[0],s=i[1];return Object(o.useEffect)((function(){var t=!1,r=e();if(void 0!==r&&null!==r)return r.then((function(e){t||s(e)})),function(){t=!0}}),t),a}(Object(M.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading model"),e.next=3,B.b(B.a.mediapipeFacemesh,{shouldLoadIrisModel:!1,maxFaces:1});case 3:return t=e.sent,console.log("Loaded model"),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)}))),[],void 0)}var k=r(264);function A(e,t){return e.scaledMesh.map((function(e){var r=Object(n.a)(e,3),c=r[0],o=r[1],i=r[2];return[c/t.videoWidth,-o/t.videoHeight,i/t.videoWidth]}))}function L(e,t){return{topLeft:[e.boundingBox.topLeft[0]/t.videoWidth,-e.boundingBox.topLeft[1]/t.videoHeight],bottomRight:[e.boundingBox.bottomRight[0]/t.videoWidth,-e.boundingBox.bottomRight[1]/t.videoHeight]}}function S(e){var t=function(e){var t=new j.Vector3(e[151][0],e[151][1],-e[151][2]),r=new j.Vector3(e[285][0],e[285][1],-e[285][2]),n=new j.Vector3(e[55][0],e[55][1],-e[55][2]),c=(new j.Vector3).subVectors(t,r),o=(new j.Vector3).subVectors(t,n);return(new j.Vector3).crossVectors(o,c).normalize()}(e),r=function(e){var t=Object(V.a)(j.Vector3,Object(h.a)(e[4])),r=Object(V.a)(j.Vector3,Object(h.a)(e[10])),n=Object(V.a)(j.Vector3,Object(h.a)(e[152])),c=(new j.Vector3).subVectors(t,r),o=(new j.Vector3).subVectors(t,n);return(new j.Vector3).crossVectors(c,o).normalize()}(e);return{up:function(e){return Object(V.a)(j.Vector3,Object(h.a)(e[9])).sub(Object(V.a)(j.Vector3,Object(h.a)(e[199]))).normalize()}(e),forward:t,left:r}}var z=r(261);function H(){var e=Object(o.useRef)(null);return Object(a.a)(e,!0),Object(b.jsxs)(c.a,{style:{position:"relative",width:"100%",height:"100%"},align:"center",children:[Object(b.jsx)(T,{}),Object(b.jsx)("video",{ref:e,style:{boxSizing:"border-box",outline:"none",width:"100%",height:"100%"},width:"100%",height:"100%",src:u})]})}function T(){var e=Object(o.useRef)(null),t=function(e,t){var r=Object(z.a)({ref:e}),c=r.width,i=r.height,a=Object(o.useState)([window.innerWidth,window.innerHeight]),s=Object(n.a)(a,2),u=Object(n.a)(s[0],2),b=u[0],d=u[1],j=s[1];return Object(o.useEffect)((function(){if(e.current&&c&&i&&t){var r=e.current;r.srcObject!==t&&(r.srcObject=t,r.play());var n=t.getVideoTracks()[0];r.width=n.getSettings().width,r.height=n.getSettings().height;var o=r.width/r.height,a=Math.min(c,i*o),s=Math.min(c/o,i);j([a,s])}}),[i,c,e,t]),[b,d]}(e,Object(s.b)((function(e){return e.webcamStream}))),r=Object(n.a)(t,2),c=r[0],a=r[1],u=function(e){var t=Object(o.useRef)([]),r=R();return Object(y.a)(25,Object(M.a)(w.a.mark((function n(){var c,o;return w.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.current&&r){n.next=2;break}return n.abrupt("return");case 2:if(!((c=e.current).readyState<HTMLMediaElement.HAVE_METADATA)){n.next=5;break}return n.abrupt("return");case 5:return n.next=7,r.estimateFaces({input:e.current,returnTensors:!1,flipHorizontal:!1,predictIrises:!1});case 7:o=n.sent,t.current=o.map((function(e){var t=A(e,c),r=L(e,c),n=S(t),o=t[10],i=t[152],a=t[12],s=t[15],u=Object(V.a)(j.Vector3,Object(h.a)(o)).distanceTo(Object(V.a)(j.Vector3,Object(h.a)(i))),b=Object(V.a)(j.Vector3,Object(h.a)(a)).distanceTo(Object(V.a)(j.Vector3,Object(h.a)(s)));return{scaledMesh:t,boundingBox:r,orthoVectors:n,mouthOpened:Object(k.c)((b/u-.03)/.15,0,1)}}));case 9:case"end":return n.stop()}}),n)})))),t}(e);return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("video",{style:{position:"absolute",top:0,boxSizing:"border-box",outline:"none",width:"100%",height:"100%"},ref:e}),Object(b.jsx)(i.a,{style:{position:"absolute",width:c+"px",height:a+"px",top:"50%",transform:"translateY(-50%)"},orthographic:!1,children:Object(b.jsx)(g,{predictions:u})})]})}}}]);
//# sourceMappingURL=7.8213d7db.chunk.js.map