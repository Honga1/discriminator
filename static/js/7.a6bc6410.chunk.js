(this.webpackJsonpdisc=this.webpackJsonpdisc||[]).push([[7],{195:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),i=n(245),a=n(4);function o(){var e=Object(r.useRef)([]),t=Object(a.b)((function(e){return e.webcamHTMLElement}));return Object(r.useEffect)((function(){return i.a.subscribe(t,(function(t){e.current=t}))}),[t]),e}},245:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(16),i=n.n(r),a=n(25),o=n(13),c=n(77),u=n(72),s=n(156),v=n(357),l=(n(356),n(75)),m=n(192);function f(e){var t=new Set,n=e,r=function(e){t.delete(e)};return{get:function(){return n},set:function(e){n!==e&&(n=e,t.forEach((function(e){return e(n)})))},subscribe:function(e){return t.add(e),function(){return r(e)}},listeners:t}}var d=function e(){Object(s.a)(this,e)};function b(e){var t=e[10],n=e[152],r=e[12],i=e[15],a=Object(c.a)(m.Vector3,Object(u.a)(t)).distanceTo(Object(c.a)(m.Vector3,Object(u.a)(n))),o=Object(c.a)(m.Vector3,Object(u.a)(r)).distanceTo(Object(c.a)(m.Vector3,Object(u.a)(i)));return Object(l.a)((o/a-.03)/.15,0,1)}function h(e){var t=e[159],n=e[145],r=e[33],i=e[133],a=e[386],o=e[374],s=e[362],v=e[263],f=Object(c.a)(m.Vector3,Object(u.a)(r)).distanceTo(Object(c.a)(m.Vector3,Object(u.a)(i))),d=Object(c.a)(m.Vector3,Object(u.a)(s)).distanceTo(Object(c.a)(m.Vector3,Object(u.a)(v))),b=Object(c.a)(m.Vector3,Object(u.a)(n)).distanceTo(Object(c.a)(m.Vector3,Object(u.a)(t))),h=Object(c.a)(m.Vector3,Object(u.a)(o)).distanceTo(Object(c.a)(m.Vector3,Object(u.a)(a))),x=Object(l.a)(b/(2*f),0,1),g=Object(l.a)(h/(2*d),0,1);return x>.11&&g>.11}function x(e,t){return e.scaledMesh.map((function(e){var n=Object(o.a)(e,3),r=n[0],i=n[1],a=n[2];return[r/t.videoWidth,-i/t.videoHeight,-a/t.videoWidth]}))}function g(e,t){var n=t.videoWidth/t.videoHeight;return t.videoHeight>t.videoWidth?e.mesh.map((function(e){var t=Object(o.a)(e,3),r=t[0],i=t[1],a=t[2];return[r/192,-i/192*n,-a/192]})):e.mesh.map((function(e){var t=Object(o.a)(e,3),r=t[0],i=t[1],a=t[2];return[(r-96)/192/n+.5,-i/192,-a/192]}))}function p(e,t){return{topLeft:[e.boundingBox.topLeft[0]/t.videoWidth,-e.boundingBox.topLeft[1]/t.videoHeight],bottomRight:[e.boundingBox.bottomRight[0]/t.videoWidth,-e.boundingBox.bottomRight[1]/t.videoHeight]}}function j(e){var t=function(e){var t=new m.Vector3(e[151][0],e[151][1],e[151][2]),n=new m.Vector3(e[285][0],e[285][1],e[285][2]),r=new m.Vector3(e[55][0],e[55][1],e[55][2]),i=(new m.Vector3).subVectors(t,n),a=(new m.Vector3).subVectors(t,r);return(new m.Vector3).crossVectors(a,i).normalize()}(e),n=function(e){var t=Object(c.a)(m.Vector3,Object(u.a)(e[4])),n=Object(c.a)(m.Vector3,Object(u.a)(e[10])),r=Object(c.a)(m.Vector3,Object(u.a)(e[152])),i=(new m.Vector3).subVectors(t,n),a=(new m.Vector3).subVectors(t,r);return(new m.Vector3).crossVectors(i,a).normalize()}(e);return{up:function(e){return Object(c.a)(m.Vector3,Object(u.a)(e[199])).sub(Object(c.a)(m.Vector3,Object(u.a)(e[9]))).normalize()}(e),forward:t,left:n}}d.predictions=f([]),d.modelPromise=void 0,d.webcam=void 0,d.isUpdating=!1,d.hasFirstFace=f(!1),d.update=Object(a.a)(i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.isUpdating=!1,0!==d.predictions.listeners.size){e.next=3;break}return e.abrupt("return");case 3:if(void 0===d.modelPromise&&(console.log("Loading model"),d.modelPromise=v.b(v.a.mediapipeFacemesh,{shouldLoadIrisModel:!0,maxFaces:1}),console.log("Loaded model")),void 0!==d.webcam){e.next=6;break}return e.abrupt("return");case 6:if(t=d.webcam,d.isUpdating=!0,!(t.readyState<HTMLMediaElement.HAVE_METADATA)){e.next=10;break}return e.abrupt("return",requestAnimationFrame(d.update));case 10:return e.next=12,d.modelPromise;case 12:return e.next=14,e.sent.estimateFaces({input:t,returnTensors:!1,flipHorizontal:!1,predictIrises:!0});case 14:n=e.sent,d.hasFirstFace.set(!0),r=n.map((function(e){var n=x(e,t),r=g(e,t);return{scaledMesh:n,boundingBox:p(e,t),orthoVectors:j(r),mouthOpened:b(r),mesh:r,eyesOpened:h(r)}})),d.predictions.set(r),requestAnimationFrame(d.update);case 19:case"end":return e.stop()}}),e)}))),d.subscribe=function(e,t){var n=d.predictions.subscribe(t);return console.log("Added subscriber, have ".concat(d.predictions.listeners.size," listeners")),d.webcam=e,d.isUpdating||d.update(),function(){return console.log("Removing subscriber"),n()}},d.get=d.predictions.get},293:function(e,t){},294:function(e,t){},338:function(e,t){},412:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var r=n(13),i=n(220),a=n(204),o=n(71),c=n(1),u=n(195),s=n(245),v=n(4),l=n(192),m=n(0);function f(){Object(c.useEffect)((function(){v.a.setState({isCameraEnabled:!0})}),[]);var e=Object(c.useState)(0),t=Object(r.a)(e,2),n=t[0],u=t[1];Object(c.useEffect)((function(){var e,t,n;return u(0),s.a.hasFirstFace.get()?(e=setTimeout((function(){return u(1)}),5e3),t=setTimeout((function(){return u(2)}),1e4)):n=s.a.hasFirstFace.subscribe((function(){e=setTimeout((function(){return u(1)}),5e3),t=setTimeout((function(){return u(2)}),1e4)})),function(){var r;null===(r=n)||void 0===r||r(),e&&clearTimeout(e),t&&clearTimeout(t)}}),[]);var l=Object(i.useSpring)((function(){return{amount:1===n||2===n?1:0,config:{duration:5e3}}}),[n]),f=Object(r.a)(l,2),b=f[0].amount;f[1];return Object(m.jsx)("div",{style:{position:"absolute",width:"100%",height:"100%"},children:Object(m.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},children:[Object(m.jsx)(a.a,{orthographic:!0,children:Object(m.jsx)(d,{amount:b})}),Object(m.jsx)("div",{style:{position:"absolute",width:"100%",padding:"58px",top:0,boxSizing:"border-box",textAlign:"center"},children:Object(m.jsxs)(o.a,{color:"yellow",size:"32px",style:{textShadow:"0px 4px 4px rgba(0, 0, 0, 0.25)"},children:[0===n&&"You don't look happy :(",1===n&&"Let's see what we can do to fix that.",2===n&&"There, much better!"]})})]})})}function d(e){var t=e.amount,n=Object(v.b)((function(e){return e.webcamHTMLElement})),r=Object(v.b)((function(e){return e.webcamAspect})),i=Object(a.c)((function(e){return e.viewport})),o=Object(c.useRef)(),s=Math.min(i.width,i.height*r),f=Math.min(i.width/r,i.height),d=Object(c.useMemo)((function(){return new l.VideoTexture(n)}),[n]),x=Object(u.a)();return function(e,t){var n=[61,185,40,39,37,0,267,269,270,409,291,146,91,181,84,17,314,405,321,375,291];Object(a.b)((function(){var r,i=e.current[0];if(i){var a=i.scaledMesh,o=b(n,a),c=o.xMin,u=o.yMax,s=o.xMax,v=o.yMin;void 0!==(null===(r=t.current)||void 0===r?void 0:r.material)&&(t.current.material.uniforms.mouth.value.x=c,t.current.material.uniforms.mouth.value.y=u+1,t.current.material.uniforms.mouth.value.z=s,t.current.material.uniforms.mouth.value.w=v+1)}}))}(x,o),function(e,t){var n=[225,228,189,128];Object(a.b)((function(){var r,i=e.current[0];if(i){var a=i.scaledMesh,o=b(n,a),c=o.xMin,u=o.yMax,s=o.xMax,v=o.yMin;void 0!==(null===(r=t.current)||void 0===r?void 0:r.material)&&(t.current.material.uniforms.leftEye.value.x=c,t.current.material.uniforms.leftEye.value.y=u+1,t.current.material.uniforms.leftEye.value.z=s,t.current.material.uniforms.leftEye.value.w=v+1)}}))}(x,o),function(e,t){var n=[445,448,413,357];Object(a.b)((function(){var r,i=e.current[0];if(i){var a=i.scaledMesh,o=b(n,a),c=o.xMin,u=o.yMax,s=o.xMax,v=o.yMin;void 0!==(null===(r=t.current)||void 0===r?void 0:r.material)&&(t.current.material.uniforms.rightEye.value.x=c,t.current.material.uniforms.rightEye.value.y=u+1,t.current.material.uniforms.rightEye.value.z=s,t.current.material.uniforms.rightEye.value.w=v+1)}}))}(x,o),function(e,t){var n=[473,474,475,476,477];Object(a.b)((function(){var r,i=e.current[0];if(i){var a=i.scaledMesh,o=b(n,a),c=o.xMin,u=o.yMax,s=o.xMax,v=o.yMin;void 0!==(null===(r=t.current)||void 0===r?void 0:r.material)&&(t.current.material.uniforms.leftIris.value.x=c,t.current.material.uniforms.leftIris.value.y=u+1,t.current.material.uniforms.leftIris.value.z=s,t.current.material.uniforms.leftIris.value.w=v+1)}}))}(x,o),function(e,t){var n=[468,469,470,471,472];Object(a.b)((function(){var r,i=e.current[0];if(i){var a=i.scaledMesh,o=b(n,a),c=o.xMin,u=o.yMax,s=o.xMax,v=o.yMin;void 0!==(null===(r=t.current)||void 0===r?void 0:r.material)&&(t.current.material.uniforms.rightIris.value.x=c,t.current.material.uniforms.rightIris.value.y=u+1,t.current.material.uniforms.rightIris.value.z=s,t.current.material.uniforms.rightIris.value.w=v+1)}}))}(x,o),Object(a.b)((function(){o.current&&(o.current.material.uniforms.amount.value=t.get())})),Object(m.jsx)("group",{scale:[s,f,1],children:Object(m.jsxs)("mesh",{ref:o,children:[Object(m.jsx)("planeBufferGeometry",{}),Object(m.jsx)("primitive",{object:h,attach:"material","uniforms-map-value":d,"uniforms-mouth-value":new l.Vector4(.5,.5,.5,.5),"uniforms-leftEye-value":new l.Vector4(.5,.5,.5,.5),"uniforms-rightEye-value":new l.Vector4(.5,.5,.5,.5),"uniforms-rightIris-value":new l.Vector4(.5,.5,.5,.5),"uniforms-leftIris-value":new l.Vector4(.5,.5,.5,.5),"uniforms-amount-value":0})]})})}function b(e,t){var n=1/0,i=-1/0,a=-1/0,o=1/0;return e.forEach((function(e){var c=t[e],u=Object(r.a)(c,2),s=u[0],v=u[1];n=Math.min(n,s),i=Math.max(i,s),o=Math.min(o,v),a=Math.max(a,v)})),{xMin:n,yMax:a,xMax:i,yMin:o}}var h=new l.ShaderMaterial({fragmentShader:"\nvarying vec2 vUv;\nuniform sampler2D map;\nuniform vec4 mouth;\nuniform vec4 leftEye;\nuniform vec4 rightEye;\nuniform vec4 leftIris;\nuniform vec4 rightIris;\nuniform float amount;\n\nvec4 desaturate(vec3 color, float factor)\n{\n\tvec3 lum = vec3(0.299, 0.587, 0.114);\n\tvec3 gray = vec3(dot(lum, color));\n\treturn vec4(mix(color, gray, factor), 1.0);\n}\n\nstruct Result {\n  vec2 uv;\n  float mixDistance;\n};\n\nResult getSmile() {\n  vec2 topLeft = mouth.xy;\n  vec2 bottomRight = mouth.zw;\n  vec2 fromTopLeft = vUv - topLeft;\n  vec2 distance = bottomRight - topLeft;\n  vec2 relativeDistance = fromTopLeft / distance;\n  float distanceXFromCenter = abs((relativeDistance.x - 0.5)*2.0);\n\n  float mixDistance = clamp(length((relativeDistance - 0.5)*vec2(1.2, 0.4)), 0.0, 1.0);\n\n  vec2 center = (topLeft + bottomRight) / 2.0;\n  vec2 distanceFromCenterLine = (center - vUv)/distance;\n\n  float y = vUv.y - pow(abs(distanceFromCenterLine.x) /3.0, 2.5) * (1.2 - (vUv.y - topLeft.y)/distance.y) * 5.0;\n  float x = vUv.x + distanceFromCenterLine.x*distance.x * 0.5;\n\n\n  Result result;\n\n  result.uv = vec2(x, y);\n  result.mixDistance = 1.0 - mixDistance;\n\n  return result;\n}\n\nResult getLeftEye() {\n  vec2 leftIrisCenter = (leftIris.xy + leftIris.zw)/2.0;\n  vec2 topLeft = leftEye.xy;\n  vec2 bottomRight = leftEye.zw;\n  vec2 fromTopLeft = vUv - topLeft;\n  vec2 distance = bottomRight - topLeft;\n  vec2 relativeDistance = fromTopLeft / distance;\n  float distanceXFromCenter = abs((relativeDistance.x - 0.5)*2.0);\n\n  float mixDistance = clamp(length((relativeDistance - 0.5)*vec2(1.0, 0.7)), 0.0, 1.0);\n\n  vec2 center = leftIrisCenter;\n  vec2 distanceFromCenterLine = (center - vUv)/distance;\n  float y = vUv.y + distanceFromCenterLine.y*distance.y;\n  float x = vUv.x + distanceFromCenterLine.x*distance.x;\n\n  Result result;\n\n  result.uv = vec2(x, y);\n  result.mixDistance = 1.0 - mixDistance;\n\n  return result;\n}\n\n\nResult getRightEye() {\n  vec2 rightIrisCenter = (rightIris.xy + rightIris.zw)/2.0;\n\n  vec2 topLeft = rightEye.xy;\n  vec2 bottomRight = rightEye.zw;\n  vec2 fromTopLeft = vUv - topLeft;\n  vec2 distance = bottomRight - topLeft;\n  vec2 relativeDistance = fromTopLeft / distance;\n  float distanceXFromCenter = abs((relativeDistance.x - 0.5)*2.0);\n\n  float mixDistance = clamp(length((relativeDistance - 0.5)*vec2(1.0, 0.7)), 0.0, 1.0);\n\n  vec2 center = rightIrisCenter;\n  vec2 distanceFromCenterLine = (center - vUv)/distance;\n  float y = vUv.y + distanceFromCenterLine.y*distance.y;\n  float x = vUv.x + distanceFromCenterLine.x*distance.x;\n\n  Result result;\n\n  result.uv = vec2(x, y);\n  result.mixDistance = 1.0 - mixDistance;\n\n  return result;\n}\n\n\nvoid main() {\n    Result smile = getSmile();\n    Result leftEyeKawaii = getLeftEye();\n    Result rightEyeKawaii = getRightEye();\n    vec2 uv = mix(vUv, smile.uv, smile.mixDistance * amount);\n    uv = mix(uv, leftEyeKawaii.uv, leftEyeKawaii.mixDistance * amount);\n    uv = mix(uv, rightEyeKawaii.uv, rightEyeKawaii.mixDistance * amount);\n    vec4 texelColor = texture2D( map, uv );\n    gl_FragColor = desaturate(texelColor.rgb, 1.0 - amount);\n}\n",vertexShader:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec3 transformed = vec3( position );\n  vUv = uv.xy;\n  vec4 mvPosition = vec4( transformed, 1.0 );\n  mvPosition = modelViewMatrix * mvPosition;\n  gl_Position = projectionMatrix * mvPosition;\n\n}\n",transparent:!0,uniforms:{map:{value:void 0},mouth:{value:void 0},leftEye:{value:void 0},rightEye:{value:void 0},leftIris:{value:void 0},rightIris:{value:void 0},amount:{value:void 0}}})}}]);
//# sourceMappingURL=7.a6bc6410.chunk.js.map